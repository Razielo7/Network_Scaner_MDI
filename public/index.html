<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>MDI Network Diagnostics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Real-time network monitoring and speed analysis tool">
  <style>
    /* NEON THEME CSS */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg: 220 20% 10%;
      --bg-card: 220 25% 15%;
      --text: 210 40% 98%;
      --text-muted: 215 20% 65%;
      --accent-cyan: 190 100% 50%;
      --accent-green: 150 100% 50%;
      --accent-purple: 270 100% 65%;
      --accent-blue: 210 100% 60%;
      --accent-orange: 30 100% 60%;
      --border: 220 25% 25%;
      --error: 0 70% 50%;
      --glass-bg: hsla(220, 25%, 15%, 0.4);
      --glass-border: hsla(220, 25%, 25%, 0.3);
    }

    body {
      font-family: 'Outfit', sans-serif;
      /* Background handled by #sky-bg */
      background-color: transparent;
      color: hsl(var(--text));
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      overflow-x: hidden;
      /* Prevent horizontal scroll */
    }

    .container {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
    }

    /* Header Section */
    .st-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .st-title {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: hsl(var(--accent-cyan));
    }

    .st-start-btn {
      background: hsl(var(--accent-cyan));
      color: #000;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 0 15px hsl(var(--accent-cyan) / 0.3);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .st-start-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 0 25px hsl(var(--accent-cyan) / 0.5);
    }

    .st-start-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    /* Progress Bar */
    .st-progress-container {
      margin-bottom: 2rem;
    }

    .st-progress-labels {
      display: flex;
      justify-content: space-between;
      color: hsl(var(--text-muted));
      font-family: monospace;
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }

    .st-progress-bar {
      height: 8px;
      background: hsl(var(--bg-card));
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .st-progress-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0%;
      background: linear-gradient(90deg, hsl(var(--accent-cyan)), hsl(var(--accent-purple)));
      box-shadow: 0 0 10px hsl(var(--accent-cyan) / 0.5);
      transition: width 0.2s;
    }

    /* 2x2 Grid */
    .st-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .st-card {
      background: hsl(var(--bg-card));
      border: 1px solid hsl(var(--border));
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .st-icon {
      width: 24px;
      height: 24px;
      margin-bottom: 0.5rem;
    }

    .st-value {
      font-size: 2rem;
      font-weight: 700;
      line-height: 1;
    }

    .st-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: hsl(var(--text-muted));
    }

    /* Text Colors */
    .text-cyan {
      color: hsl(var(--accent-cyan));
    }

    .text-green {
      color: hsl(var(--accent-green));
    }

    .text-purple {
      color: hsl(var(--accent-purple));
    }

    .text-blue {
      color: hsl(var(--accent-blue));
    }

    .text-orange {
      color: hsl(var(--accent-orange));
    }

    /* Graph Section */
    .st-graph-section {
      margin-top: 1rem;
    }

    .st-graph-header {
      color: hsl(var(--text-muted));
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 1rem;
    }

    .st-graph-container {
      height: 150px;
      width: 100%;
      position: relative;
    }

    .st-graph-container svg {
      width: 100%;
      height: 100%;
      overflow: visible;
    }

    /* Device Info Styles */
    .di-card {
      background: hsl(var(--bg-card));
      border: 1px solid hsl(var(--border));
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .di-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid hsl(var(--border));
    }

    .di-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: hsl(var(--accent-cyan));
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .di-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .di-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background: hsl(var(--bg) / 0.5);
      border-radius: 8px;
    }

    .di-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: hsl(var(--text-muted));
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .di-value {
      font-family: monospace;
      font-size: 0.95rem;
      color: hsl(var(--accent-cyan));
    }

    .di-footer {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid hsl(var(--border) / 0.5);
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: hsl(var(--text-muted));
    }

    .di-footer strong {
      color: hsl(var(--text));
    }

    /* Target Systems Styles */
    .ts-card {
      width: 100%;
      max-width: 800px;
      margin: 0 auto 2rem auto;
      background: hsl(var(--bg-card) / 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid hsl(var(--border) / 0.5);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .ts-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .ts-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: hsl(var(--accent-cyan));
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ts-ping-all-btn {
      background: transparent;
      border: 1px solid hsl(var(--accent-cyan));
      color: hsl(var(--accent-cyan));
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .ts-ping-all-btn:hover {
      background: hsl(var(--accent-cyan) / 0.1);
    }

    .ts-search-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .ts-search-input {
      flex: 1;
      background: hsl(var(--bg) / 0.5);
      border: 1px solid hsl(var(--border));
      color: hsl(var(--text));
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-family: inherit;
    }

    .ts-go-btn {
      background: hsl(var(--accent-cyan));
      color: #000;
      border: none;
      width: 42px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Visual Line */
    .ts-visual-line {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      padding: 0 1rem;
    }

    .ts-node {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      position: relative;
      z-index: 2;
    }

    .ts-node-icon {
      width: 48px;
      height: 48px;
      background: hsl(var(--bg) / 0.5);
      border: 1px solid hsl(var(--border));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: hsl(var(--accent-cyan));
    }

    .ts-line-track {
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, hsl(var(--accent-cyan)), hsl(var(--accent-purple)), hsl(var(--accent-green)));
      margin: 0 1rem;
      position: relative;
      top: -14px;
      z-index: 1;
    }

    .ts-line-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: currentColor;
    }

    /* Target List */
    .ts-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .ts-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      background: hsl(var(--bg) / 0.3);
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid transparent;
      transition: background 0.2s;
    }

    .ts-item:hover {
      background: hsl(var(--bg) / 0.6);
      border-color: hsl(var(--border) / 0.5);
    }

    .ts-item-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .ts-check-icon {
      color: hsl(var(--accent-green));
      width: 20px;
      height: 20px;
    }

    .ts-name {
      font-weight: 600;
      color: hsl(var(--text-muted));
    }

    .ts-ping-val {
      font-family: monospace;
      font-weight: 600;
    }

    .ts-ping-val.good {
      color: hsl(var(--accent-green));
    }

    .ts-ping-val.fair {
      color: hsl(var(--accent-orange));
    }

    .ts-ping-val.poor {
      color: hsl(var(--error));
    }

    /* Legend */
    .ts-legend {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 2rem;
      font-size: 0.75rem;
      color: hsl(var(--text-muted));
    }

    .ts-legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .ts-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Wide Top Bar (Device Info) */
    .di-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      max-width: 800px;
      margin: 0 auto 2rem auto;
      padding: 0.5rem 1rem;
      background: hsl(var(--bg-card) / 0.15);
      backdrop-filter: blur(4px);
      border: 1px solid hsl(var(--border) / 0.4);
      border-radius: 50px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      font-size: 0.8rem;
      gap: 1.5rem;
    }

    .di-bar-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .di-bar-label {
      color: hsl(var(--text-muted));
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.65rem;
      letter-spacing: 1px;
    }

    .di-bar-value {
      color: hsl(var(--text));
      font-weight: 600;
      white-space: nowrap;
      font-size: 0.85rem;
    }

    /* Small Start Button */
    .st-start-btn-small {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 1px solid hsl(var(--accent-cyan));
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(4px);
      color: hsl(var(--accent-cyan));
      font-size: 0.75rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 0 15px hsl(var(--accent-cyan) / 0.2);
    }

    .st-start-btn-small:hover {
      background: hsl(var(--accent-cyan));
      color: hsl(var(--bg));
      box-shadow: 0 0 20px hsl(var(--accent-cyan) / 0.6);
      transform: scale(1.1) rotate(90deg);
    }

    .st-start-btn-small:active {
      transform: scale(0.9);
    }

    /* SEA & ANIMATION STYLES */
    .sea-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: -1;
    }

    /* Bubbles - deeper and more subtle */
    .bubbles {
      position: fixed;
      top: 55%;
      left: 0;
      width: 100%;
      height: 45%;
      z-index: -2;
      pointer-events: none;
      overflow: hidden;
    }

    .bubble {
      position: absolute;
      bottom: -20px;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.2), transparent);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: rise 15s infinite ease-in;
    }

    @keyframes rise {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0;
      }

      10% {
        opacity: 0.3;
      }

      100% {
        transform: translateY(-50vh) translateX(30px);
        opacity: 0;
      }
    }

    /* Vessel with bobbing */
    /* Vessel with bobbing - Split animations */
    .vessel-container {
      position: absolute;
      top: calc(55% - 45px);
      left: -150px;
      z-index: 5;
      filter: drop-shadow(0 20px 20px rgba(0, 0, 0, 0.4));
      animation: sail-across 60s linear infinite;
    }

    .vessel-inner {
      animation: bobbing 3s ease-in-out infinite;
      transform-origin: center bottom;
    }

    @keyframes bobbing {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      50% {
        transform: translateY(8px) rotate(1deg);
      }
    }

    /* Old Wave CSS Removed */

    /* Vessel */


    @keyframes sail-across {
      0% {
        transform: translateX(-150px) scale(0.9);
      }

      100% {
        transform: translateX(calc(100vw + 300px)) scale(0.9);
      }
    }

    .vessel-lights {
      position: absolute;
      top: 15px;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 35px;
    }

    .light {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      animation: blink 1s infinite alternate;
    }

    .light.red {
      background: #ff0000;
      box-shadow: 0 0 10px #ff0000;
    }

    .light.green {
      background: #00ff00;
      box-shadow: 0 0 10px #00ff00;
    }

    @keyframes blink {
      0% {
        opacity: 0.4;
      }

      100% {
        opacity: 1;
      }
    }

    /* Fish - Silhouettes */
    .fish-school {
      position: absolute;
      top: 55%;
      /* Starts at horizon */
      left: 0;
      width: 100%;
      height: 45%;
      /* Underwater area */
      pointer-events: none;
      z-index: 1;
      /* Inside/Behind waves */
      overflow: hidden;
    }

    .fish {
      position: absolute;
      opacity: 0.5;
      fill: #020617;
      /* Dark silhouette */
    }

    .fish-1 {
      width: 40px;
      top: 30%;
      left: -100px;
      animation: swim 20s linear infinite;
      opacity: 0.6;
    }

    .fish-2 {
      width: 25px;
      top: 60%;
      left: -100px;
      animation: swim 30s linear infinite reverse;
      /* Swims backward/other way? Or just different speed. 'reverse' makes it go right to left if swim is left to right */
      animation-delay: 5s;
      opacity: 0.4;
      filter: blur(1px);
    }

    .fish-jump {
      position: absolute;
      top: 55%;
      /* Horizon */
      left: 50%;
      width: 35px;
      z-index: 6;
      /* In front of waves when jumping */
      fill: #1e293b;
      animation: jump 18s ease-in-out infinite;
      animation-delay: 8s;
      opacity: 0;
    }

    @keyframes swim {
      0% {
        transform: translateX(-100px);
        left: -50px;
      }

      100% {
        transform: translateX(100vw);
        left: 100%;
      }
    }

    @keyframes jump {

      0%,
      85% {
        transform: translate(0, 0) rotate(0deg);
        opacity: 0;
      }

      88% {
        opacity: 1;
        transform: translate(-20px, 0) rotate(-45deg);
      }

      90% {
        transform: translate(50px, -120px) rotate(0deg);
        /* Arc Peak */
        opacity: 1;
      }

      92% {
        transform: translate(120px, 0) rotate(45deg);
        /* Re-entry */
        opacity: 1;
      }

      93%,
      100% {
        opacity: 0;
        transform: translate(140px, 20px);
      }
    }




    /* Sea Canvas */
    #sea-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      /* Above sky, below content */
    }

    /* Sky Gradient Background */
    #sky-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -10;
      background: linear-gradient(180deg, #e0f2fe 0%, #bae6fd 40%, #7dd3fc 60%, #0284c7 100%);
      pointer-events: none;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
</head>

<body>
  <!-- Sky Background -->
  <div id="sky-bg"></div>

  <!-- BUBBLES CONTAINER -->
  <div class="bubbles" id="bubbles"></div>

  <!-- ANIMATION CONTAINER -->
  <div class="sea-container">
    <canvas id="sea-canvas"></canvas>

    <!-- Vessel -->
    <div class="vessel-container">
      <div class="vessel-inner">
        <svg width="120" height="60" viewBox="0 0 120 60" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M10,40 L30,40 L30,25 L50,25 L50,40 L90,40 L100,20 L110,20 L100,40 L115,40 C118,40 120,42 120,45 C120,55 110,60 60,60 C10,60 0,55 0,45 C0,42 2,40 5,40 Z"
            fill="#0f172a" />
          <path d="M35,25 L35,10 L65,10 L65,25 Z" fill="#1e293b" />
          <rect x="40" y="15" width="5" height="5" fill="#38bdf8" />
          <rect x="55" y="15" width="5" height="5" fill="#38bdf8" />
          <path d="M10,48 L110,48" stroke="#334155" stroke-width="2" />
          <text x="75" y="55" fill="#64748b" font-family="sans-serif" font-size="6" font-weight="bold">MDI-NET</text>
        </svg>
        <div class="vessel-lights">
          <div class="light red"></div>
          <div class="light green"></div>
        </div>
      </div>
    </div>

    <!-- Fish -->
    <div class="fish-school">
      <!-- Fish 1 -->
      <svg class="fish fish-1" viewBox="0 0 640 512" fill="currentColor">
        <path
          d="M632 308c0-4.4-3.6-8-8-8h-20c-3.1 0-5.9 1.8-7.2 4.6l-24 53.3-64.8-19.1c16-25.7 26.2-54.8 28.5-85.8h60.5c4.1 0 7.6-3.1 7.9-7.2 2.7-33 11-78.5 48.1-98.8 6.5-3.5 10.1-10.8 7.3-17.7l-9.5-23.7c-2.4-5.9-8.4-9.3-14.7-8.2-56.7 9.4-78.8 38.3-90.1 57.3-6.5-33.1-23.4-62.8-48-85.1 7.2-12.7 13.5-37.4-4-64.9-3.7-5.9-10.2-9.4-17.2-9.4h-28.9c-7.9 0-15.1 4.5-18.7 11.6l-18 36c-13.3-3.6-27.3-5.6-41.9-5.6-88 0-160 67.5-170.8 153.2-3.5 28.1 4 56.4 18.6 81.6l-50.6 14.9c-5.7-16-16.7-29.3-31.4-37.5-17.7-9.8-39.6-9.1-56.6 1.8l-52.6 33.6c-10.1 6.5-12.9 20.1-6.2 30 6.5 9.6 19.3 12.1 28.9 5.8l20.1-13.1c12.3 26.4 39 44.9 69.8 44.9 31.8 0 59.1-19.6 70.8-47.3L225 352.8c25.4 12.9 54.3 20.2 85 20.2 60.1 0 113.6-28.2 144.6-72.1l77.7 22.9c3.1 .9 6.4-.3 8.4-2.8l27.9-35.9c3.8-4.9 2.5-12-3-15.1l-18.4-10.5c4.7-7.7 8.6-15.8 11.6-24.1h21.1c4.4 0 8-3.6 8-8v-20.4z" />
      </svg>
      <!-- Fish 2 -->
      <svg class="fish fish-2" viewBox="0 0 512 512" fill="currentColor">
        <path
          d="M495.8 156.9c-27.2-22.3-56.9-24.8-67.6-24.8-19.8 0-45.6 7-68.5 17.5-22-38.3-63.5-64.1-111-64.1-74.9 0-136.6 63.6-143.6 141.2-16.1-5-31.6-12.3-43.9-22.6-7.8-6.5-18.7-8.1-28.1-4.1C18.6 206 7.4 220 4.1 235.3c-5.4 25.1 8 50.8 30.6 57.6 19 5.8 41.5 5.5 61.3-1.8 19.7 34.7 56.6 58.3 99.3 58.3 25.5 0 49-8.4 68.2-22.6 18.2 15.6 42.4 25.1 69.2 25.1 28.5 0 53.6-10.8 72.7-28.4 14.5 11 31.3 16.9 49.3 16.9 14.2 0 28.1-3.7 40.7-10.4 10.3-5.5 15.3-17.5 11.5-28.6-27.7-81.8 13-132.8 14.9-134.7 5.9-6.1 4.9-16-2-20.8z" />
      </svg>
      <!-- Random Extra Fish -->
      <svg class="fish fish-1" style="top:70%; left: 20%; animation-delay: 12s; width: 15px; opacity: 0.2"
        viewBox="0 0 640 512" fill="currentColor">
        <path
          d="M632 308c0-4.4-3.6-8-8-8h-20c-3.1 0-5.9 1.8-7.2 4.6l-24 53.3-64.8-19.1c16-25.7 26.2-54.8 28.5-85.8h60.5c4.1 0 7.6-3.1 7.9-7.2 2.7-33 11-78.5 48.1-98.8 6.5-3.5 10.1-10.8 7.3-17.7l-9.5-23.7c-2.4-5.9-8.4-9.3-14.7-8.2-56.7 9.4-78.8 38.3-90.1 57.3-6.5-33.1-23.4-62.8-48-85.1 7.2-12.7 13.5-37.4-4-64.9-3.7-5.9-10.2-9.4-17.2-9.4h-28.9c-7.9 0-15.1 4.5-18.7 11.6l-18 36c-13.3-3.6-27.3-5.6-41.9-5.6-88 0-160 67.5-170.8 153.2-3.5 28.1 4 56.4 18.6 81.6l-50.6 14.9c-5.7-16-16.7-29.3-31.4-37.5-17.7-9.8-39.6-9.1-56.6 1.8l-52.6 33.6c-10.1 6.5-12.9 20.1-6.2 30 6.5 9.6 19.3 12.1 28.9 5.8l20.1-13.1c12.3 26.4 39 44.9 69.8 44.9 31.8 0 59.1-19.6 70.8-47.3L225 352.8c25.4 12.9 54.3 20.2 85 20.2 60.1 0 113.6-28.2 144.6-72.1l77.7 22.9c3.1 .9 6.4-.3 8.4-2.8l27.9-35.9c3.8-4.9 2.5-12-3-15.1l-18.4-10.5c4.7-7.7 8.6-15.8 11.6-24.1h21.1c4.4 0 8-3.6 8-8v-20.4z" />
      </svg>
      <!-- Jumping Fish -->
      <svg class="fish fish-jump" viewBox="0 0 576 512" fill="currentColor">
        <path
          d="M569.1 426.4L452.8 14.5C447.8-2.9 422-5.4 413.4 9.9c-23.7 42-63.1 76.5-108.9 95.8-37.4 15.8-77.9 22.4-118.8 19.4-40.4-3-79-13.6-114.3-31.5C31.2 73.1 3.5 103.3 14.2 144.3l35.8 136.4c7.6 28.9 36.3 47.9 66 43.6l45.2-6.5c-4.6 24.1-1.6 49.2 8.9 71.9 12.3 26.6 28.5 50.9 48.4 71.8 18.9 19.9 45.3 31.3 72.7 31.2 26 0 52-11 70.8-30.8 54.3-57.2 89.2-132 99.4-210.7l64.1 113c12.1 21.3 43.3 19.2 52.3-3.6 4.7-11.9 5.2-24.9 1.3-37.2zM277.8 77c-36.8-29.2-92.5-12.8-100.9 33.6-1.1 6.1-8.2 8-12.3 3.3-16.7-19.4-44.5-25.9-67-15.6-8.9 4.1-18.7 1.3-24.8-6.6-15.3-19.9-10.8-49.3 11-63.5 35.5-23.1 82.5-31.1 120.9-18.4 9.1 3 13.9 12.7 10.9 21.8-3 9-12.7 13.8-21.8 10.9-27.6-9.1-61.9-3.2-87.9 13.6-7.8 5.1-9.6 15.6-3.8 23 2.1 2.7 5.2 4 8.3 4 5.3 0 10.5-3.6 12.4-9.3 6.9-20.9 27.5-33.8 49.6-31.1 4.5 .5 106.6 25 105.4 34.4z" />
      </svg>
    </div>
  </div>
  <!-- Header -->
  <header style="width:100%; max-width:800px; margin-bottom:2rem;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div style="display:flex; align-items:center; gap:1rem;">
        <div
          style="width:48px; height:48px; background:hsl(var(--bg-card)); border:1px solid hsl(var(--border)); border-radius:12px; display:flex; align-items:center; justify-content:center; color:hsl(var(--accent-cyan));">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="2" width="20" height="8" rx="2" ry="2" />
            <rect x="2" y="14" width="20" height="8" rx="2" ry="2" />
            <line x1="6" y1="6" x2="6.01" y2="6" />
            <line x1="6" y1="18" x2="6.01" y2="18" />
          </svg>
        </div>
        <div>
          <h1 style="font-size:1.5rem;"><span style="color:hsl(var(--accent-cyan));">Network</span> Diagnostics</h1>
          <p style="font-size:0.8rem; color:hsl(var(--text-muted));">Real-time network monitoring & speed analysis</p>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:0.5rem; color:hsl(var(--accent-green)); font-size:0.8rem;">
        <span
          style="width:8px; height:8px; background:currentColor; border-radius:50%; animation:pulse 2s infinite;"></span>
        Live
      </div>
    </div>
  </header>

  <!-- Device Info Bar -->
  <div class="di-bar">
    <div class="di-bar-item">
      <span class="di-bar-label">Status</span>
      <div class="di-value" style="color:hsl(var(--accent-green)); display:flex; align-items:center; gap:0.5rem;">
        <span style="width:8px; height:8px; background:currentColor; border-radius:50%;"></span> Online
      </div>
    </div>
    <div class="di-sep"></div>
    <div class="di-bar-item">
      <span class="di-bar-label">Local IP</span>
      <div class="di-bar-value" id="connList">...</div>
    </div>
    <div class="di-sep"></div>
    <div class="di-bar-item">
      <span class="di-bar-label">Public IP</span>
      <div class="di-bar-value" id="publicIP">...</div>
    </div>
    <div class="di-sep"></div>
    <div class="di-bar-item">
      <span class="di-bar-label">ISP/Region</span>
      <div class="di-bar-value" id="country">...</div>
    </div>
    <div class="di-bar-item" style="margin-left:auto;">
      <button class="ts-ping-all-btn" onclick="location.reload()" title="Refresh Info"><svg width="16" height="16"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M23 4v6h-6" />
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
        </svg></button>
    </div>
  </div>

  <!-- Target Systems -->
  <div class="ts-card">
    <div class="ts-header">
      <div class="ts-title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10" />
          <circle cx="12" cy="12" r="6" />
          <circle cx="12" cy="12" r="2" />
        </svg>
        Target Systems
      </div>
      <button class="ts-ping-all-btn" id="refreshBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
        </svg> Ping All
      </button>
    </div>

    <div class="ts-search-container">
      <div style="flex:1; position:relative;">
        <input type="text" class="ts-search-input" placeholder="Enter hostname or IP...">
      </div>
      <button class="ts-go-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="5" y1="12" x2="19" y2="12" />
          <polyline points="12 5 19 12 12 19" />
        </svg>
      </button>
    </div>

    <div class="ts-visual-line">
      <div class="ts-node">
        <div class="ts-node-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="2" width="20" height="8" rx="2" ry="2" />
            <rect x="2" y="14" width="20" height="8" rx="2" ry="2" />
            <line x1="6" y1="6" x2="6.01" y2="6" />
            <line x1="6" y1="18" x2="6.01" y2="18" />
          </svg>
        </div>
        <div style="font-size:0.75rem; color:hsl(var(--text-muted));">Your Device</div>
      </div>
      <div class="ts-line-track">
        <div class="ts-line-dot" style="left:20%; color:hsl(var(--accent-cyan))"></div>
        <div class="ts-line-dot" style="left:50%; color:hsl(var(--accent-purple))"></div>
        <div class="ts-line-dot" style="left:80%; color:hsl(var(--accent-green))"></div>
      </div>
      <div class="ts-node">
        <div class="ts-node-icon"
          style="color:hsl(var(--accent-green)); border-color:hsl(var(--accent-green)/0.5); background:hsl(var(--accent-green)/0.1)">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <path d="M22 12h-4" />
            <path d="M6 12H2" />
            <path d="M12 6V2" />
            <path d="M12 22v-4" />
          </svg>
        </div>
        <div style="font-size:0.75rem; color:hsl(var(--text-muted));">Target</div>
      </div>
    </div>

    <div
      style="font-size:0.7rem; text-transform:uppercase; letter-spacing:1px; color:hsl(var(--text-muted)); margin-bottom:1rem;">
      Connectivity Status</div>

    <div class="ts-list" id="targetsList"></div>

    <div class="ts-legend">
      <div class="ts-legend-item">
        <div class="ts-dot" style="background:hsl(var(--accent-green))"></div> &lt;50ms
      </div>
      <div class="ts-legend-item">
        <div class="ts-dot" style="background:hsl(var(--accent-orange))"></div> &lt;150ms
      </div>
      <div class="ts-legend-item">
        <div class="ts-dot" style="background:hsl(var(--error))"></div> &gt;150ms
      </div>
    </div>
  </div>

  <!-- Speed Test Bar -->
  <div class="di-bar" style="margin-top: -1rem; margin-bottom: 2rem;">
    <div class="di-bar-item"
      style="border-right: 1px solid hsl(var(--border) / 0.5); padding-right: 1.5rem; margin-right: 1rem;">
      <div style="font-size: 0.9rem; font-weight: 800; color: hsl(var(--accent-cyan)); letter-spacing: 1px;">INTERNET
        SPEED</div>
    </div>

    <div class="di-bar-item">
      <span class="di-bar-label">Download</span>
      <div class="di-bar-value" style="color:hsl(var(--accent-green)); min-width:60px;">
        <span id="dlSpeed">--</span> <span style="font-size:0.7em; opacity:0.7;">Mbps</span>
      </div>
    </div>

    <div class="di-sep"></div>

    <div class="di-bar-item">
      <button id="startSpeed" class="st-start-btn-small" title="Start Speed Test">GO</button>
    </div>

    <div class="di-sep"></div>

    <div class="di-bar-item">
      <span class="di-bar-label">Upload</span>
      <div class="di-bar-value" style="color:hsl(var(--accent-purple)); min-width:60px;">
        <span id="ulSpeed">--</span> <span style="font-size:0.7em; opacity:0.7;">Mbps</span>
      </div>
    </div>

    <!-- Hidden Elements -->
    <div style="display:none;">
      <span id="latency">--</span>
      <canvas id="gaugeCanvas" width="300" height="300"></canvas>
      <div id="gaugeVal">0.0</div>
      <div id="jitter"></div>
      <div id="packetLoss"></div>
      <canvas id="downloadGraphInline"></canvas>
      <canvas id="uploadGraphInline"></canvas>
      <div id="uploadGraph"></div>
      <div id="downloadGraph"></div>
      <div id="testProgressTxt"></div>
      <div id="testProgressBar"></div>
    </div>
  </div>

  <div id="errorContainer"></div>

  <script>
    // ========= API HELPERS =========
    async function apiCall(action, params = {}) {
      const url = `/api/${action}?` + new URLSearchParams(params);
      const response = await fetch(url);
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      return response.json();
    }

    // ========= END USER INFO MODULE =========
    const EndUserInfo = {
      async loadSystemInfo() {
        try {
          const listEl = document.getElementById('connList');
          listEl.innerHTML = '';

          const localIPs = await this.getWebRTCLocalIPs();

          if (localIPs.length > 0) {
            localIPs.forEach(ip => {
              listEl.innerHTML += `<div style="margin-bottom:2px;">${ip} <span style="font-size:0.7rem; color:hsl(var(--text-muted))">(WiFi/LAN)</span></div>`;
            });
          }

          const clientData = await this.getClientConnectionIP();
          if (clientData && clientData.data && clientData.data.client_ip) {
            if (!localIPs.includes(clientData.data.client_ip)) {
              listEl.innerHTML += `<div style="margin-bottom:2px;">${clientData.data.client_ip} <span style="font-size:0.7rem; color:hsl(var(--text-muted))">(Gateway)</span></div>`;
            }
          } else if (localIPs.length === 0) {
            listEl.innerHTML = '<span style="color:hsl(var(--error))">Unknown</span>';
          }
        } catch (e) {
          console.error('Failed to load network information:', e.message);
          document.getElementById('connList').innerHTML = '<div style="color:hsl(var(--text-muted))">Error</div>';
        }
      },

      async getWebRTCLocalIPs() {
        return new Promise((resolve) => {
          const ips = new Set();
          try {
            const pc = new RTCPeerConnection({ iceServers: [] });
            pc.createDataChannel('');
            pc.onicecandidate = (e) => {
              if (!e.candidate) { pc.close(); resolve(Array.from(ips)); return; }
              const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
              const match = e.candidate.candidate.match(ipRegex);
              if (match) {
                const ip = match[1];
                if (ip !== '0.0.0.0' && ip !== '127.0.0.1' && (ip.startsWith('192.168.') || ip.startsWith('10.') || ip.startsWith('172.'))) {
                  ips.add(ip);
                }
              }
            };
            pc.createOffer().then(sdp => pc.setLocalDescription(sdp)).catch(() => resolve([]));
            setTimeout(() => resolve(Array.from(ips)), 1000);
          } catch { resolve([]); }
        });
      },

      async getClientConnectionIP() {
        try { return await apiCall('system-info'); }
        catch { return null; }
      },

      async loadPublicInfo() {
        try {
          const res = await fetch('https://api.ipify.org?format=json');
          const ipData = await res.json();
          document.getElementById('publicIP').textContent = ipData.ip;

          const geoRes = await fetch(`https://ipapi.co/${ipData.ip}/json/`);
          const geo = await geoRes.json();
          document.getElementById('country').innerHTML = `${geo.country_name || 'Unknown'} ${geo.country_code ? `<img src="https://flagcdn.com/16x12/${geo.country_code.toLowerCase()}.png">` : ''}`;
        } catch {
          document.getElementById('publicIP').textContent = 'Error';
        }
      }
    };

    // ========= TARGET SYSTEM MODULE =========
    const TargetSystem = {
      targets: [
        { key: 'dns.google', name: 'Google DNS', host: '8.8.8.8' },
        { key: 'cloudflare.com', name: 'Cloudflare', host: '1.1.1.1' },
        { key: 'google.com', name: 'Google', host: 'google.com' },
        { key: 'github.com', name: 'GitHub', host: 'github.com' },
        { key: '9.9.9.9', name: 'Quad9', host: '9.9.9.9' }
      ],

      renderTargets() {
        document.getElementById('targetsList').innerHTML = this.targets.map((t, i) => `
          <div class="ts-item" id="row-${i}" onclick="TargetSystem.toggleDetails(${i}, '${t.key}')">
            <div class="ts-item-info">
              <svg class="ts-check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/><polyline points="16 9 12 15 8 11"/>
              </svg>
              <div style="font-weight:600; font-size:0.9rem; text-transform:uppercase;">${t.name}</div>
            </div>
            <div class="ts-ping-val" id="ping-${i}">...</div>
          </div>
          <div class="ts-details-panel" id="details-${i}" style="display:none; padding:1rem; background:hsl(var(--bg)/0.2); margin-bottom:0.5rem; border-radius:8px;">
            <div class="detail-grid" id="grid-${i}">Loading...</div>
          </div>
        `).join('');
      },

      async checkAllTargets() { this.targets.forEach((t, i) => this.checkTarget(i)); },

      async checkTarget(i) {
        const pingEl = document.getElementById(`ping-${i}`);
        const row = document.getElementById(`row-${i}`);
        const icon = row ? row.querySelector('.ts-check-icon') : null;

        if (pingEl) pingEl.style.opacity = '0.5';

        try {
          const json = await apiCall('ping', { host: this.targets[i].key });
          const res = json.data;

          if (pingEl) pingEl.style.opacity = '1';

          let latency = 999, displayTxt = 'Err';
          if (res && res.latency !== -1) { latency = res.latency; displayTxt = latency + 'ms'; }
          if (pingEl) pingEl.textContent = displayTxt;

          if (latency < 50) {
            if (pingEl) pingEl.className = 'ts-ping-val good';
            if (icon) icon.style.color = 'hsl(var(--accent-green))';
          } else if (latency < 150) {
            if (pingEl) pingEl.className = 'ts-ping-val fair';
            if (icon) icon.style.color = 'hsl(var(--accent-orange))';
          } else {
            if (pingEl) pingEl.className = 'ts-ping-val poor';
            if (icon) icon.style.color = 'hsl(var(--error))';
          }
        } catch {
          if (pingEl) { pingEl.textContent = 'Err'; pingEl.className = 'ts-ping-val poor'; pingEl.style.opacity = '1'; }
          if (icon) icon.style.color = 'hsl(var(--error))';
        }
      },

      async toggleDetails(i, hostKey) {
        const details = document.getElementById(`details-${i}`);
        if (details.style.display === 'block') { details.style.display = 'none'; return; }
        document.querySelectorAll('.ts-details-panel').forEach(d => d.style.display = 'none');
        details.style.display = 'block';

        try {
          document.getElementById(`grid-${i}`).innerHTML = '<div class="detail-item">Loading...</div>';
          const json = await apiCall('details', { host: hostKey });
          const d = json.data;
          document.getElementById(`grid-${i}`).innerHTML = `
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; font-size:0.8rem;">
              <div><span style="color:hsl(var(--text-muted))">Server Ping:</span> <span style="color:hsl(var(--accent-cyan))">${d.total_time}</span></div>
              <div><span style="color:hsl(var(--text-muted))">HTTP Code:</span> <span style="color:hsl(var(--accent-cyan))">${d.http_code}</span></div>
              <div><span style="color:hsl(var(--text-muted))">Security:</span> <span style="color:hsl(var(--accent-cyan))">${d.ssl_verify}</span></div>
            </div>
          `;
        } catch {
          document.getElementById(`grid-${i}`).innerHTML = `<div style="color:hsl(var(--error))">Server Check Failed</div>`;
        }
      },

      refresh() { this.renderTargets(); this.checkAllTargets(); }
    };

    document.getElementById('refreshBtn').onclick = () => TargetSystem.refresh();

    // ========= SPEED TEST MODULE =========
    const SpeedTest = {
      config: {
        downloadSize: 25000000,
        uploadSize: 20 * 1024 * 1024,
        uploadProxyEndpoint: '/api/upload-proxy',
        concurrentStreams: 4,
        minTestDuration: 3000
      },

      state: { latencies: [], minLatency: Infinity, maxLatency: 0, currentJitter: 0, packetLoss: 0, downloadHistory: [], uploadHistory: [], streamProgress: [], isUploading: false, isRunning: false },

      resetState() {
        this.state = { latencies: [], minLatency: Infinity, maxLatency: 0, currentJitter: 0, packetLoss: 0, downloadHistory: [], uploadHistory: [], streamProgress: new Array(this.config.concurrentStreams).fill(0), isUploading: false, isRunning: false };
      },

      async measureLatency(samples = 10) {
        try { await fetch('https://speed.cloudflare.com/__down?bytes=0', { cache: 'no-store', mode: 'cors' }); } catch { }
        const latencies = [];
        for (let i = 0; i < samples; i++) {
          try {
            const start = performance.now();
            const response = await fetch('https://speed.cloudflare.com/__down?bytes=0', { cache: 'no-store', mode: 'cors' });
            const end = performance.now();
            if (!response.ok) throw new Error();
            const latency = end - start;
            latencies.push(latency);
            this.state.latencies.push(latency);
            if (latency < this.state.minLatency) this.state.minLatency = latency;
            if (latency > this.state.maxLatency) this.state.maxLatency = latency;
            const latEl = document.getElementById('latency');
            if (latEl) latEl.textContent = latency.toFixed(0) + ' ms';
            await new Promise(r => setTimeout(r, 50));
          } catch { }
        }
        if (latencies.length > 1) {
          const mean = latencies.reduce((a, b) => a + b, 0) / latencies.length;
          const variance = latencies.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / latencies.length;
          this.state.currentJitter = Math.sqrt(variance);
        }
        this.state.packetLoss = ((samples - latencies.length) / samples) * 100;
        return latencies.length > 0 ? Math.min(...latencies) : null;
      },

      async testDownload() {
        const dlEl = document.getElementById('dlSpeed');
        if (dlEl) dlEl.textContent = '0.0';
        this.state.streamProgress = new Array(this.config.concurrentStreams).fill(0);
        const startTime = performance.now();
        const streams = [];
        for (let i = 0; i < this.config.concurrentStreams; i++) streams.push(this.runDownloadStream(i));

        return new Promise((resolve, reject) => {
          const interval = setInterval(() => {
            const now = performance.now();
            const totalLoaded = this.state.streamProgress.reduce((a, b) => a + b, 0);
            const elapsed = (now - startTime) / 1000;
            if (elapsed > 0) {
              const currentMbps = ((totalLoaded * 8) / 1000000) / elapsed;
              if (dlEl) dlEl.textContent = currentMbps.toFixed(1);
              this.state.downloadHistory.push({ time: now - startTime, speed: currentMbps });
            }
          }, 60);

          Promise.all(streams).then(() => {
            clearInterval(interval);
            const totalTime = (performance.now() - startTime) / 1000;
            const finalLoaded = this.state.streamProgress.reduce((a, b) => a + b, 0);
            const mbps = ((finalLoaded * 8) / 1000000) / totalTime;
            if (dlEl) dlEl.textContent = mbps.toFixed(1);
            resolve(mbps);
          }).catch(e => { clearInterval(interval); if (dlEl) dlEl.textContent = 'Err'; reject(e); });
        });
      },

      async runDownloadStream(index) {
        try {
          const response = await fetch(`https://speed.cloudflare.com/__down?bytes=${this.config.downloadSize}`, { cache: 'no-store', mode: 'cors' });
          if (!response.ok) throw new Error();
          const reader = response.body.getReader();
          let received = 0;
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            received += value.length;
            this.state.streamProgress[index] = received;
          }
        } catch { }
      },

      async testUpload() {
        const ulEl = document.getElementById('ulSpeed');
        if (ulEl) ulEl.textContent = '0.0';
        this.state.streamProgress = new Array(this.config.concurrentStreams).fill(0);
        this.state.isUploading = true;
        const startTime = performance.now();

        const chunkSize = 1024 * 1024;
        const payload = new Uint8Array(chunkSize);
        for (let i = 0; i < 1024; i++) payload[i] = i % 255;
        let filled = 1024;
        while (filled < chunkSize) { payload.copyWithin(filled, 0, Math.min(filled, chunkSize - filled)); filled *= 2; }

        const streams = [];
        for (let i = 0; i < this.config.concurrentStreams; i++) streams.push(this.runUploadLoop(i, payload));

        return new Promise((resolve, reject) => {
          const interval = setInterval(() => {
            const now = performance.now();
            const totalLoaded = this.state.streamProgress.reduce((a, b) => a + b, 0);
            const elapsed = (now - startTime) / 1000;
            if (elapsed > 0.2) {
              const currentMbps = ((totalLoaded * 8) / 1000000) / elapsed;
              if (ulEl) ulEl.textContent = currentMbps.toFixed(1);
              this.state.uploadHistory.push({ time: now - startTime, speed: currentMbps });
            }
            if (elapsed > (this.config.minTestDuration / 1000) && totalLoaded > 5 * 1024 * 1024) {
              this.state.isUploading = false;
            }
          }, 50);

          Promise.all(streams).then(() => {
            clearInterval(interval);
            const endTime = performance.now();
            const totalTime = (endTime - startTime) / 1000;
            const finalLoaded = this.state.streamProgress.reduce((a, b) => a + b, 0);
            const mbps = ((finalLoaded * 8) / 1000000) / totalTime;
            if (ulEl) ulEl.textContent = mbps.toFixed(1);
            resolve(mbps);
          }).catch(e => { clearInterval(interval); this.state.isUploading = false; if (ulEl) ulEl.textContent = 'Err'; reject(e); });
        });
      },

      async runUploadLoop(index, payload) {
        let streamTotal = 0;
        while (this.state.isUploading) {
          try {
            await this.performSingleUpload(payload);
            streamTotal += payload.byteLength;
            this.state.streamProgress[index] = streamTotal;
          } catch { break; }
        }
      },

      performSingleUpload(payload) {
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.addEventListener('load', () => { if (xhr.status >= 200 && xhr.status < 300) resolve(); else reject(new Error(`HTTP ${xhr.status}`)); });
          xhr.addEventListener('error', () => reject(new Error('Network error')));
          xhr.open('POST', this.config.uploadProxyEndpoint);
          xhr.setRequestHeader('Content-Type', 'application/octet-stream');
          xhr.send(payload);
        });
      },

      async runFullTest() {
        const btn = document.getElementById('startSpeed');
        if (btn) {
          btn.disabled = true;
          btn.style.borderColor = 'hsl(var(--accent-green))';
          btn.style.color = 'hsl(var(--accent-green))';
          btn.style.boxShadow = '0 0 15px hsl(var(--accent-green)/0.4)';
          btn.textContent = '...';
        }

        this.state.isRunning = true;
        this.resetState();

        try {
          await this.measureLatency();
          await this.testDownload();

          if (btn) {
            btn.style.borderColor = 'hsl(var(--accent-purple))';
            btn.style.color = 'hsl(var(--accent-purple))';
            btn.style.boxShadow = '0 0 15px hsl(var(--accent-purple)/0.4)';
          }
          await this.testUpload();
        } catch (e) { console.error(e); }
        finally {
          this.state.isRunning = false;
          if (btn) {
            btn.disabled = false;
            btn.style.borderColor = '';
            btn.style.color = '';
            btn.style.boxShadow = '';
            btn.textContent = 'AGAIN';
          }
        }
      }
    };

    document.getElementById('startSpeed').onclick = () => SpeedTest.runFullTest();

    // ========= INIT =========
    async function init() {
      TargetSystem.renderTargets();
      try {
        await Promise.all([
          EndUserInfo.loadSystemInfo(),
          EndUserInfo.loadPublicInfo(),
          TargetSystem.checkAllTargets()
        ]);
      } catch (e) { console.error(e); }
    }

    init();

    // Fish Randomizer
    setInterval(() => {
      const fish = document.querySelectorAll('.fish:not(.fish-jump)');
      fish.forEach(f => {
        // If fish is off-screen (swim cycle reset), randomize depth
        if (f.getBoundingClientRect().right < 0 || f.getBoundingClientRect().left > window.innerWidth) {
          // Random percentage between 10% and 90% of the underwater area
          f.style.top = (Math.random() * 80 + 10) + '%';
        }
      });
    }, 2000);

    // Create Bubbles
    const bubbleContainer = document.getElementById('bubbles');
    for (let i = 0; i < 20; i++) {
      const b = document.createElement('div');
      b.className = 'bubble';
      const size = Math.random() * 10 + 5;
      b.style.width = size + 'px';
      b.style.height = size + 'px';
      b.style.left = Math.random() * 100 + '%';
      b.style.animationDuration = (Math.random() * 10 + 5) + 's';
      b.style.animationDelay = (Math.random() * 5) + 's';
      bubbleContainer.appendChild(b);
    }

    // ========= WAVE ANIMATION =========

    // Minimal SimplexNoise implementation
    class SimplexNoise {
      constructor() {
        this.grad3 = [[1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0], [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1], [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1]];
        this.p = [];
        for (let i = 0; i < 256; i++) { this.p[i] = Math.floor(Math.random() * 256); }
        this.perm = [];
        for (let i = 0; i < 512; i++) { this.perm[i] = this.p[i & 255]; }
      }
      dot(g, x, y) { return g[0] * x + g[1] * y; }
      noise2D(xin, yin) {
        let n0, n1, n2;
        const F2 = 0.5 * (Math.sqrt(3.0) - 1.0);
        const s = (xin + yin) * F2;
        const i = Math.floor(xin + s);
        const j = Math.floor(yin + s);
        const G2 = (3.0 - Math.sqrt(3.0)) / 6.0;
        const t = (i + j) * G2;
        const X0 = i - t;
        const Y0 = j - t;
        const x0 = xin - X0;
        const y0 = yin - Y0;
        let i1, j1;
        if (x0 > y0) { i1 = 1; j1 = 0; } else { i1 = 0; j1 = 1; }
        const x1 = x0 - i1 + G2;
        const y1 = y0 - j1 + G2;
        const x2 = x0 - 1.0 + 2.0 * G2;
        const y2 = y0 - 1.0 + 2.0 * G2;
        const ii = i & 255;
        const jj = j & 255;
        const gi0 = this.perm[ii + this.perm[jj]] % 12;
        const gi1 = this.perm[ii + i1 + this.perm[jj + j1]] % 12;
        const gi2 = this.perm[ii + 1 + this.perm[jj + 1]] % 12;

        let t0 = 0.5 - x0 * x0 - y0 * y0;
        if (t0 < 0) n0 = 0.0;
        else { t0 *= t0; n0 = t0 * t0 * this.dot(this.grad3[gi0], x0, y0); }

        let t1 = 0.5 - x1 * x1 - y1 * y1;
        if (t1 < 0) n1 = 0.0;
        else { t1 *= t1; n1 = t1 * t1 * this.dot(this.grad3[gi1], x1, y1); }

        let t2 = 0.5 - x2 * x2 - y2 * y2;
        if (t2 < 0) n2 = 0.0;
        else { t2 *= t2; n2 = t2 * t2 * this.dot(this.grad3[gi2], x2, y2); }

        return 70.0 * (n0 + n1 + n2);
      }
    }

    const $ = {};

    /*========================================
    Utility
    ========================================*/

    $.PI = Math.PI;
    $.TAU = $.PI * 2;

    $.rand = function (min, max) {
      if (!max) {
        var max = min;
        min = 0;
      }
      return Math.random() * (max - min) + min;
    };

    /*========================================
    Initialize
    ========================================*/

    $.init = () => {
      $.c = document.getElementById('sea-canvas');
      $.ctx = $.c.getContext('2d');
      $.simplex = new SimplexNoise();
      $.events();
      $.reset();
      $.loop();
    };

    /*========================================
    Reset
    ========================================*/

    $.reset = () => {
      $.dpr = window.devicePixelRatio || 1;
      $.w = window.innerWidth;
      $.h = window.innerHeight;
      $.c.width = $.w * $.dpr;
      $.c.height = $.h * $.dpr;
      $.c.style.width = `${$.w}px`;
      $.c.style.height = `${$.h}px`;
      $.ctx.scale($.dpr, $.dpr);

      // Animation params
      // Horizon height
      $.horizon = $.h * 0.55;

      // Layer config: [count, amp, speed, color, y-offset-noise]
      $.layers = [
        { count: Math.floor($.w / 60), amp: 15, speed: 0.001, color: 'rgba(30, 58, 138, 0.6)', yOff: 0 },   // Dark Blue
        { count: Math.floor($.w / 50), amp: 20, speed: 0.002, color: 'rgba(23, 37, 84, 0.7)', yOff: 10 },    // Navy
        { count: Math.floor($.w / 40), amp: 30, speed: 0.003, color: 'rgba(15, 23, 42, 0.8)', yOff: 20 },    // Darker Slate
        { count: Math.floor($.w / 30), amp: 40, speed: 0.004, color: 'rgba(2, 6, 23, 0.9)', yOff: 30 },      // Near Black
      ];

      $.t = 0;
    };

    /*========================================
    Event
    ========================================*/

    $.events = () => {
      window.addEventListener('resize', $.reset.bind(this));
    };

    /*========================================
    Wave
    ========================================*/

    $.drawWave = (layer, index) => {
      $.ctx.beginPath();

      // Noise inputs
      let xoff = 0;
      let xinc = 0.03 + (index * 0.01);
      let yinc = layer.speed;

      // Time-based offset for this layer
      let yTime = $.t * yinc;

      // Start slightly off-screen left
      $.ctx.moveTo(-20, $.horizon);

      // Draw points
      for (let i = 0; i <= layer.count + 2; i++) {
        xoff += xinc;

        let x = (-20) + (($.w + 40) / layer.count) * i;

        // Simplex noise: x-noise + time-noise
        let noiseVal = $.simplex.noise2D(xoff, yTime);
        let sway = $.simplex.noise2D(yTime, 0) * (layer.amp * 0.5);

        let y = $.horizon + noiseVal * layer.amp + sway + (index * 15); // Offset each layer slightly down

        $.ctx.lineTo(x, y);
      }

      // Close shape to bottom corners
      $.ctx.lineTo($.w + 20, $.h);
      $.ctx.lineTo(-20, $.h);
      $.ctx.closePath();

      // Fill
      $.ctx.fillStyle = layer.color;
      $.ctx.fill();
    };

    // Deep Ocean Gradient Fill for the bottom-most area
    $.drawDeepOcean = () => {
      const grad = $.ctx.createLinearGradient(0, $.horizon, 0, $.h);
      grad.addColorStop(0, 'rgba(3, 105, 161, 0.1)');
      grad.addColorStop(1, 'rgba(2, 6, 23, 0.95)'); // Very dark at bottom
      $.ctx.fillStyle = grad;
      $.ctx.fillRect(0, $.horizon, $.w, $.h - $.horizon);
    };

    /*========================================
    Loop
    ========================================*/

    $.loop = () => {
      requestAnimationFrame($.loop);
      $.ctx.clearRect(0, 0, $.w, $.h);

      $.t += 1;

      // Draw layers back to front
      $.layers.forEach((layer, i) => {
        $.drawWave(layer, i);
      });

      // Overlay deep ocean darkness
      $.drawDeepOcean();
    };

    /*========================================
    Start
    ========================================*/

    // Robust initialization
    // Start immediately
    $.init();
  </script>


  <div class="bubbles" id="bubbles"></div>

  <!-- ANIMATION CONTAINER -->
  <div class="sea-container">
    <canvas id="sea-canvas"></canvas>

    <!-- Vessel -->
    <div class="vessel-container">
      <div class="vessel-inner">
        <svg width="120" height="60" viewBox="0 0 120 60" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M10,40 L30,40 L30,25 L50,25 L50,40 L90,40 L100,20 L110,20 L100,40 L115,40 C118,40 120,42 120,45 C120,55 110,60 60,60 C10,60 0,55 0,45 C0,42 2,40 5,40 Z"
            fill="#0f172a" />
          <path d="M35,25 L35,10 L65,10 L65,25 Z" fill="#1e293b" />
          <rect x="40" y="15" width="5" height="5" fill="#38bdf8" />
          <rect x="55" y="15" width="5" height="5" fill="#38bdf8" />
          <path d="M10,48 L110,48" stroke="#334155" stroke-width="2" />
          <text x="75" y="55" fill="#64748b" font-family="sans-serif" font-size="6" font-weight="bold">MDI-NET</text>
        </svg>
        <div class="vessel-lights">
          <div class="light red"></div>
          <div class="light green"></div>
        </div>
      </div>
    </div>

    <!-- Fish -->
    <div class="fish-school">
      <!-- Fish 1 -->
      <svg class="fish fish-1" viewBox="0 0 640 512" fill="currentColor">
        <path
          d="M632 308c0-4.4-3.6-8-8-8h-20c-3.1 0-5.9 1.8-7.2 4.6l-24 53.3-64.8-19.1c16-25.7 26.2-54.8 28.5-85.8h60.5c4.1 0 7.6-3.1 7.9-7.2 2.7-33 11-78.5 48.1-98.8 6.5-3.5 10.1-10.8 7.3-17.7l-9.5-23.7c-2.4-5.9-8.4-9.3-14.7-8.2-56.7 9.4-78.8 38.3-90.1 57.3-6.5-33.1-23.4-62.8-48-85.1 7.2-12.7 13.5-37.4-4-64.9-3.7-5.9-10.2-9.4-17.2-9.4h-28.9c-7.9 0-15.1 4.5-18.7 11.6l-18 36c-13.3-3.6-27.3-5.6-41.9-5.6-88 0-160 67.5-170.8 153.2-3.5 28.1 4 56.4 18.6 81.6l-50.6 14.9c-5.7-16-16.7-29.3-31.4-37.5-17.7-9.8-39.6-9.1-56.6 1.8l-52.6 33.6c-10.1 6.5-12.9 20.1-6.2 30 6.5 9.6 19.3 12.1 28.9 5.8l20.1-13.1c12.3 26.4 39 44.9 69.8 44.9 31.8 0 59.1-19.6 70.8-47.3L225 352.8c25.4 12.9 54.3 20.2 85 20.2 60.1 0 113.6-28.2 144.6-72.1l77.7 22.9c3.1 .9 6.4-.3 8.4-2.8l27.9-35.9c3.8-4.9 2.5-12-3-15.1l-18.4-10.5c4.7-7.7 8.6-15.8 11.6-24.1h21.1c4.4 0 8-3.6 8-8v-20.4z" />
      </svg>

      <!-- Fish 2 -->
      <svg class="fish fish-2" viewBox="0 0 512 512" fill="currentColor">
        <path
          d="M495.8 156.9c-27.2-22.3-56.9-24.8-67.6-24.8-19.8 0-45.6 7-68.5 17.5-22-38.3-63.5-64.1-111-64.1-74.9 0-136.6 63.6-143.6 141.2-16.1-5-31.6-12.3-43.9-22.6-7.8-6.5-18.7-8.1-28.1-4.1C18.6 206 7.4 220 4.1 235.3c-5.4 25.1 8 50.8 30.6 57.6 19 5.8 41.5 5.5 61.3-1.8 19.7 34.7 56.6 58.3 99.3 58.3 25.5 0 49-8.4 68.2-22.6 18.2 15.6 42.4 25.1 69.2 25.1 28.5 0 53.6-10.8 72.7-28.4 14.5 11 31.3 16.9 49.3 16.9 14.2 0 28.1-3.7 40.7-10.4 10.3-5.5 15.3-17.5 11.5-28.6-27.7-81.8 13-132.8 14.9-134.7 5.9-6.1 4.9-16-2-20.8z" />
      </svg>

      <!-- Random Extra Fish -->
      <svg class="fish fish-1" style="top:70%; left: 20%; animation-delay: 12s; width: 15px; opacity: 0.2"
        viewBox="0 0 640 512" fill="currentColor">
        <path
          d="M632 308c0-4.4-3.6-8-8-8h-20c-3.1 0-5.9 1.8-7.2 4.6l-24 53.3-64.8-19.1c16-25.7 26.2-54.8 28.5-85.8h60.5c4.1 0 7.6-3.1 7.9-7.2 2.7-33 11-78.5 48.1-98.8 6.5-3.5 10.1-10.8 7.3-17.7l-9.5-23.7c-2.4-5.9-8.4-9.3-14.7-8.2-56.7 9.4-78.8 38.3-90.1 57.3-6.5-33.1-23.4-62.8-48-85.1 7.2-12.7 13.5-37.4-4-64.9-3.7-5.9-10.2-9.4-17.2-9.4h-28.9c-7.9 0-15.1 4.5-18.7 11.6l-18 36c-13.3-3.6-27.3-5.6-41.9-5.6-88 0-160 67.5-170.8 153.2-3.5 28.1 4 56.4 18.6 81.6l-50.6 14.9c-5.7-16-16.7-29.3-31.4-37.5-17.7-9.8-39.6-9.1-56.6 1.8l-52.6 33.6c-10.1 6.5-12.9 20.1-6.2 30 6.5 9.6 19.3 12.1 28.9 5.8l20.1-13.1c12.3 26.4 39 44.9 69.8 44.9 31.8 0 59.1-19.6 70.8-47.3L225 352.8c25.4 12.9 54.3 20.2 85 20.2 60.1 0 113.6-28.2 144.6-72.1l77.7 22.9c3.1 .9 6.4-.3 8.4-2.8l27.9-35.9c3.8-4.9 2.5-12-3-15.1l-18.4-10.5c4.7-7.7 8.6-15.8 11.6-24.1h21.1c4.4 0 8-3.6 8-8v-20.4z" />
      </svg>


      <!-- Jumping Fish -->
      <svg class="fish fish-jump" viewBox="0 0 576 512" fill="currentColor">
        <path
          d="M569.1 426.4L452.8 14.5C447.8-2.9 422-5.4 413.4 9.9c-23.7 42-63.1 76.5-108.9 95.8-37.4 15.8-77.9 22.4-118.8 19.4-40.4-3-79-13.6-114.3-31.5C31.2 73.1 3.5 103.3 14.2 144.3l35.8 136.4c7.6 28.9 36.3 47.9 66 43.6l45.2-6.5c-4.6 24.1-1.6 49.2 8.9 71.9 12.3 26.6 28.5 50.9 48.4 71.8 18.9 19.9 45.3 31.3 72.7 31.2 26 0 52-11 70.8-30.8 54.3-57.2 89.2-132 99.4-210.7l64.1 113c12.1 21.3 43.3 19.2 52.3-3.6 4.7-11.9 5.2-24.9 1.3-37.2zM277.8 77c-36.8-29.2-92.5-12.8-100.9 33.6-1.1 6.1-8.2 8-12.3 3.3-16.7-19.4-44.5-25.9-67-15.6-8.9 4.1-18.7 1.3-24.8-6.6-15.3-19.9-10.8-49.3 11-63.5 35.5-23.1 82.5-31.1 120.9-18.4 9.1 3 13.9 12.7 10.9 21.8-3 9-12.7 13.8-21.8 10.9-27.6-9.1-61.9-3.2-87.9 13.6-7.8 5.1-9.6 15.6-3.8 23 2.1 2.7 5.2 4 8.3 4 5.3 0 10.5-3.6 12.4-9.3 6.9-20.9 27.5-33.8 49.6-31.1 4.5 .5 106.6 25 105.4 34.4z" />
      </svg>
    </div>
  </div>

</html>